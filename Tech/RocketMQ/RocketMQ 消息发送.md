# 消息发送 API

![[Pasted image 20231113235952.png]]

DefaultMQProducer 实现了 MQProducer 接口，MQProducer 继承了 MQAdmin 接口。
MQProducer 是消息发送接口，MQAdmin 是集群管理基础接口，ClientConfig 类是客户端配置类。


## 发送接口分类

按照发送方式
- 同步发送
- 异步发送：异步回调发送结果
- 一次发送：无结果返回

按一次发送消息数量分类
- 单条消息发送
- 批量消息发送

按照是否指定队列发送
- 随机选择发送
- 指定特定消息队列
- 自定义消息队列选择器

## 集群管理接口

MQAdmin 提供了对集群的基础管理能力，也提供了主题创建和消息查询等功能。

## 客户端配置说明

## DefaultMQProducer
默认发送类，使用最为广泛。


# 重要参数以及实战建议

## 发送重试机制

实际环境中，网络抖动、集群抖动的情况比较常见，引起抖动的原因也很多，不同机房之间的专线抖动、集群瞬时流量过大等，都可能导致某次消息发送失败。为了应对这种情况，RocketMQ 提供了发送重试机制。

sendMsgTimeout、retryTimesWhenSendFailed、retryTimesWhenSendAsyncFailed

重试机制：当同步/异步发送失败之后，会在发送超时时间内进行不超过重试次数的重试，默认消息发送超时时间为 3 秒，默认重试次数为 2 次，也就是说，发送失败之后，会在 3 秒内进行 2 次重试，如果超过 3 秒，即使没有重试到 2 次也不再进行重试。

最佳实践：建议将 发送超时时间 和 重试次数 设置大一点，以便有做狗的重试次数来应对发送失败的场景。比如超时时间设置为 10 秒，重试次数设置为 16 次。

## 延迟故障规避
