[MySQL索引详解 | JavaGuide(Java面试 + 学习指南)](https://javaguide.cn/database/mysql/mysql-index.html)

### 数据页简介
在 InnoDB 中，我们可以把用于存放记录的页称为数据页或者索引页（InnoDB 基于聚簇索引存放表数据）。各个数据页组成一个双向链表（File Header），每个数据页中的记录都会按照主键值从小到大的顺序组成一个单向链表（User Records），通过页目录在一个页内快速根据主键值快速查找一个记录（Page Directory）。一个数据页可以被划分为一下七个部分：
- File Header：表示页的一些通用信息，包括上一页、下一页等。
- Page Header：表示数据页专有的一些信息。
- Infimum + Supermum：两个虚拟的伪记录，分别表示页中的最小记录和最大记录。
- User Records：真正存储我们插入的数据记录，按照主键值从小到大的顺序组成一个单向链表。
- Free Space：页中尚未使用的空闲部分。
- Page Directory：相当重要的组成部分，存储页中某些记录的相对位置，也就是各个槽对应的记录在页面中的地址偏移量。用于在一个数据页内根据主键值使用二分法快速查询记录所在的槽，然后在槽中通过记录的 next_record 属性遍历该槽所在的组的记录。
- File Trailer：用于校验页是否完整，防止页在刷盘时只被刷新了部分。


### 索引的数据结构
Hash
优点：通过hash映射可以在 O(1) 时间获取对应记录
缺点：需要处理hash冲突，不能很好的支持排序和范围查询
![[Pasted image 20231207234308.png]]

二叉查找树（二叉搜索树）
缺点：容易造成树倾斜，存在树退化为线性链表的情况，导致查询变为 O(n)
![[Pasted image 20231207234321.png]]

AVL 树（平衡二叉查找树）
优点：树的高度稳定，查询复杂度 O(logn)
缺点：维持树的平衡需要较大代价。

红黑树（Red Black Tree）
优点：查询复杂度 O(logn)，O(1) 旋转和变色操作，保持大致的树平衡
缺点：大致的平衡导致查询效率不稳定。

并且索引压根就没法使用二叉树作为数据结构，一定是多叉树。
因为二叉树注定了树的高度会随着数据量的增长而增长，导致磁盘IO次数也会随之增长！

B树（多路平衡查找树）
所有的节点既存放 key 也存放 data，这导致了B树的查询效率不稳定。
所有节点之间相互独立，没有形成双向链表，这导致了B树在进行范围查询时，需要先找到最小值然后对B树进行中序遍历，这就间接的增加了磁盘IO次数。

B+树（变种多路平衡查找树）
包含了目录项页 + 数据页，其最顶层永远只有一个根节点。
非叶子节点存储的都是目录项记录，该类型记录包含了主键值和对应页号，只有叶子节点存放了完整的用户记录，包含隐藏列。
B+树每层的页都是一个双向链表，并按照主键顺序排序。一般为 2到4层，所以通过 B+树可以在4次IO以内查找到对应记录，并且在每个页面内都可以通过二分法快速定位对应记录。
![[Pasted image 20231207234412.png]]



### 索引优缺点

MyISAM 与 InnoDB

聚簇索引

普通索引（非聚簇索引、辅助索引、二级索引）

唯一索引

联合索引


SQL语句索引分析
- 扫描区间和边界条件
- 索引用于排序
- 索引用于分组


索引相关机制
索引下推

索引合并

索引跳跃扫描


limit 会影响执行计划




执行计划


MySQL 8.x 中实现的索引新特性：

- 隐藏索引：也称为不可见索引，不会被优化器使用，但是仍然需要维护，通常会软删除和灰度发布的场景中使用。主键不能设置为隐藏（包括显式设置或隐式设置）。
- 降序索引：之前的版本就支持通过 desc 来指定索引为降序，但实际上创建的仍然是常规的升序索引。直到 MySQL 8.x 版本才开始真正支持降序索引。另外，在 MySQL 8.x 版本中，不再对 GROUP BY 语句进行隐式排序。
- 函数索引：从 MySQL 8.0.13 版本开始支持在索引中使用函数或者表达式的值，也就是在索引中可以包含函数或者表达式。
